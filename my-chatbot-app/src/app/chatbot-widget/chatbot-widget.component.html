<div class="font-sans relative" [ngClass]="{'bg-slate-50 min-h-screen': isLandingPage, 'fixed bottom-5 right-5 z-[10000]': !isLandingPage}">
  
  <div class="w-full" *ngIf="isLandingPage">
    <div class="px-8 py-16 text-center text-white" [ngClass]="{
      'bg-gradient-to-br from-indigo-500 to-purple-700': backgroundStyle === 'gradient',
      'bg-indigo-600': backgroundStyle === 'plain-primary',
      'bg-gray-600': backgroundStyle === 'plain-secondary'
    }">
      <h1 class="text-4xl font-semibold mb-4">{{landingTitle}}</h1>
      <p class="text-xl opacity-90">{{landingDescription}}</p>
    </div>
  </div>

  <div class="bg-white rounded-2xl shadow-xl overflow-hidden transition-all duration-300 ease-in-out" 
       [ngClass]="{
        'w-[380px] h-[600px]': !isLandingPage, 
        'scale-0 opacity-0': !isLandingPage && isMinimized,
        'max-w-3xl mx-auto -mt-8 relative': isLandingPage
       }">
    
    <div class="bg-gradient-to-br from-indigo-500 to-purple-700 text-white p-4 flex justify-between items-center" *ngIf="!isMinimized || isLandingPage">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-xl">
          <span>ðŸ¤–</span>
        </div>
        <div>
          <h3 class="m-0 text-lg font-semibold">{{botName}}</h3>
          <span class="text-sm opacity-80">Online</span>
        </div>
      </div>
      <div class="flex gap-2" *ngIf="!isLandingPage">
        <button class="bg-white bg-opacity-20 border-none text-white w-8 h-8 rounded-full cursor-pointer flex items-center justify-center text-2xl font-bold hover:bg-opacity-30" (click)="toggleMinimize()">
          <span>âˆ’</span>
        </button>
      </div>
    </div>

    <div class="flex-1 overflow-y-auto p-4 bg-slate-50 h-[calc(100%-140px)]"
         [ngClass]="{'h-[calc(100%-160px)]': isLandingPage}"
         #messagesContainer 
         *ngIf="!isMinimized || isLandingPage">
      
      <div class="flex gap-3 mb-4 items-end" *ngIf="messages.length === 0">
        <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-base shrink-0">
          <span>ðŸ¤–</span>
        </div>
        <div class="max-w-[70%]">
          <div class="p-3 bg-white text-gray-800 rounded-2xl rounded-bl-sm shadow-sm inline-block break-words">
            {{welcomeMessage}}
          </div>
          <div class="text-xs text-gray-400 mt-1 pl-1">
            {{getCurrentTime()}}
          </div>
        </div>
      </div>

      <div class="flex gap-3 mb-4 items-end" 
           *ngFor="let message of messages" 
           [ngClass]="{'flex-row-reverse': message.isUser}">
        
        <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-base shrink-0" *ngIf="!message.isUser">
          <span>ðŸ¤–</span>
        </div>
        
        <div class="flex-1 max-w-[70%]" [ngClass]="{'text-right': message.isUser}">
          <div class="p-3 rounded-2xl break-words inline-block"
               [ngClass]="{
                 'bg-indigo-600 text-white rounded-br-sm': message.isUser, 
                 'bg-white text-gray-800 rounded-bl-sm shadow-sm': !message.isUser
               }">
            <span *ngIf="message.typing" class="flex items-center gap-1">
              <span class="w-2 h-2 rounded-full bg-gray-400 animate-pulse-delayed" style="animation-delay: -0.32s;"></span>
              <span class="w-2 h-2 rounded-full bg-gray-400 animate-pulse-delayed" style="animation-delay: -0.16s;"></span>
              <span class="w-2 h-2 rounded-full bg-gray-400 animate-pulse-delayed"></span>
            </span>
            <span *ngIf="!message.typing">{{message.text}}</span>
          </div>
          <div class="text-xs text-gray-400 mt-1 pl-1" [ngClass]="{'pr-1': message.isUser}">
            {{formatTime(message.timestamp)}}
          </div>
        </div>
        
        <div class="w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center text-base shrink-0" *ngIf="message.isUser">
          <span>ðŸ‘¤</span>
        </div>
      </div>
    </div>

    <div class="p-4 bg-white border-t border-gray-200" *ngIf="!isMinimized || isLandingPage">
      <div class="flex gap-3 items-center">
        <input type="text" 
               [(ngModel)]="currentMessage"
               (keyup.enter)="sendMessage()"
               [placeholder]="inputPlaceholder"
               [disabled]="isSending"
               class="flex-1 p-3 border border-gray-300 rounded-full text-base outline-none bg-gray-50 focus:border-indigo-600 focus:bg-white">
        <button class="w-11 h-11 bg-indigo-600 text-white border-none rounded-full cursor-pointer flex items-center justify-center transition-all duration-200 ease-in-out hover:scale-110 disabled:bg-gray-300 disabled:cursor-not-allowed disabled:hover:scale-100" 
                (click)="sendMessage()" 
                [disabled]="!currentMessage.trim() || isSending">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22,2 15,22 11,13 2,9"></polygon>
          </svg>
        </button>
      </div>
    </div>

    <div class="text-center p-2 text-xs text-gray-400 bg-gray-50 border-t border-gray-100" *ngIf="showBranding && (!isMinimized || isLandingPage)">
      <span>Powered by YourChatbot</span>
    </div>
  </div>

  <div class="w-[60px] h-[60px] rounded-full bg-indigo-600 text-white flex items-center justify-center cursor-pointer shadow-lg shadow-indigo-600/40 transition-all duration-300 ease-in-out hover:scale-110" 
       *ngIf="!isLandingPage && isMinimized"
       (click)="toggleMinimize()"
       [style.backgroundColor]="primaryColor">
    <span class="text-2xl">ðŸ’¬</span>
    <div class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold" *ngIf="unreadCount > 0">
      {{unreadCount}}
    </div>
  </div>
</div>