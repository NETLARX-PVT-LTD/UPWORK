<ng-container *ngIf="!isSelected">
  <div class="block-header">
    <div class="block-type-badges">
      <div class="block-title" (click)="onSelectBlock()">
        <mat-icon class="block-icon">{{ block.icon }}</mat-icon>
        <span>{{ block.name }}</span>
      </div>
    </div>

    <div class="block-actions">
      <button
        mat-icon-button
        [matMenuTriggerFor]="blockMenu"
        class="block-menu-trigger"
      >
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #blockMenu="matMenu">
        <button mat-menu-item (click)="onEditBlock()">
          <mat-icon>edit</mat-icon>
          <span>Edit</span>
        </button>
        <button mat-menu-item (click)="onDuplicateBlock()">
          <mat-icon>content_copy</mat-icon>
          <span>Duplicate</span>
        </button>
        <button mat-menu-item (click)="onRemoveBlock()">
          <mat-icon>delete</mat-icon>
          <span>Delete</span>
        </button>
      </mat-menu>
    </div>
  </div>

  <div class="block-body">
    <div
      class="block-description border-b-2 pb-2 border-[#CECECE]"
      *ngIf="block.description"
    >
      {{ block.description }}
    </div>

    <!-- Show API details below the description -->
    <div
      class="block-api-info mt-2 text-gray-700 space-y-1"
      *ngIf="block.apiEndpoint || block.requestType"
    >
      <div *ngIf="block.requestType">
        <strong class="text-l">Request Type : </strong> {{ block.requestType }}
      </div>
      <div *ngIf="block.apiEndpoint">
        <strong class="text-l">API Endpoint : </strong> {{ block.apiEndpoint }}
      </div>
    </div>
  </div>
</ng-container>

<div
  class="connection-point connection-output"
  (mousedown)="onStartConnection($event)"
  *ngIf="!isSelected"
>
  <div class="connection-dot"></div>
</div>

<div class="connection-point connection-input" *ngIf="!isSelected">
  <div class="connection-dot"></div>
</div>

<div class="right-panel" *ngIf="isSelected">
  <div class="panel-header">
    <!-- <div class="panel-title">JSON Plugin Integration</div> -->
    <div class="panel-subtitle">
      {{ block.description }}
    </div>
  </div>

  <div class="panel-content">
    <mat-expansion-panel
      [expanded]="expandedSection === 'apiConfig'"
      (opened)="expandedSection = 'apiConfig'"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>api</mat-icon>
          <span>API Configuration</span>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="section-content">
        <mat-form-field
          appearance="outline"
          class="full-width-input custom-height"
        >
          <!-- <mat-label>API Endpoint</mat-label> -->
          <input
            matInput
            type="url"
            [(ngModel)]="block.apiEndpoint"
            (ngModelChange)="onContentChange()"
            placeholder="Enter Your API Endpoint"
          />
          <mat-icon
            matSuffix
            class="info-icon"
            matTooltip="Enter the URL of your API endpoint."
            >info</mat-icon
          >
        </mat-form-field>

        <div class="setting-item json-format-link">
          <a
            href="https://botify.zendesk.com/hc/en-us/articles/36771596020193-JSON-API-Response-Format"
            target="_blank"
            >Check out the JSON format</a
          >
        </div>

        <mat-form-field appearance="outline" class="full-width-input">
          <mat-label>Request Type</mat-label>
          <mat-select
            [(ngModel)]="block.requestType"
            (ngModelChange)="onContentChange()"
          >
            <mat-option value="POST">POST</mat-option>
            <mat-option value="GET">GET</mat-option>
            <mat-option value="PUT">PUT</mat-option>
            <mat-option value="DELETE">DELETE</mat-option>
            <mat-option value="PATCH">PATCH</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="headers-section">
          <div class="section-header">
            <h4>Select Headers</h4>
            <mat-icon
              matTooltip="Add custom headers for your API request"
              class="info-icon"
              >info</mat-icon
            >
          </div>
          <div
            class="header-item"
            *ngFor="let header of block.apiHeaders; let i = index"
          >
            <mat-form-field appearance="outline" class="header-key-input">
              <!-- <mat-label>Header Key</mat-label> -->
              <input
                matInput
                [(ngModel)]="header.key"
                (ngModelChange)="onContentChange()"
                placeholder="Header Key"
              />
            </mat-form-field>
            <mat-form-field appearance="outline" class="header-value-input">
              <!-- <mat-label>Header Value</mat-label> -->
              <input
                matInput
                [(ngModel)]="header.value"
                (ngModelChange)="onContentChange()"
                placeholder="Header Value"
              />
            </mat-form-field>
            <button
              class="mat-icon-button w-14 h-14 self-start"
              color="warn"
              (click)="removeApiHeader(i)"
              matTooltip="Remove Header"
            >
              <mat-icon class="">delete</mat-icon>
            </button>
          </div>
          <button
            mat-stroked-button
            class="add-header-button"
            (click)="addApiHeader()"
          >
            <mat-icon>add</mat-icon>
            Add Header
          </button>
        </div>
      </div>
    </mat-expansion-panel>
  </div>
</div>
