<!-- Top Header -->
<header class="fixed top-0 left-0 overflow-hidden right-0 bg-white border-b border-gray-200 h-16 flex items-center justify-between px-6 z-50">
  <!-- Left Section -->
  <div class="flex items-center gap-4">
    <!-- <div class="flex items-center gap-2">
      <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
        <mat-icon class="text-white text-lg">bubble_chart</mat-icon>
      </div>
      <span class="font-semibold text-gray-900">Botsify</span>
    </div>
    <span class="text-gray-400">-</span>
    <span class="text-gray-700">Create chatbot design</span> -->
    <div class="flex items-center gap-3">
          <mat-icon class="text-red-500 text-2xl">play_circle_outline</mat-icon>
          <h1 class="text-2xl font-semibold text-gray-800">Edit Media Block</h1>
          <div class="flex items-center gap-2 ml-4">
            <span class="text-sm text-gray-600">Bot 2</span>
            <mat-icon class="text-gray-400 text-lg">expand_more</mat-icon>
          </div>
        </div>
  </div>

  <!-- Right Section -->
  <div class="flex items-center gap-4">
    <!-- Navigation Buttons -->
    <div class="flex items-center bg-gray-100 rounded-lg p-1">
      <button mat-flat-button class="!bg-blue-500 !text-white !text-sm font-medium !px-4 !py-2 !rounded-md !h-auto">
        âš¡ Agentic Platform
      </button>
      <button mat-flat-button class="!bg-green-500 !text-white !text-sm font-medium !px-4 !py-2 !rounded-md !h-auto !ml-1">
        ðŸ’¬ Partner Portal
      </button>
    </div>
    
    <!-- User Avatar -->
    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
      <mat-icon class="text-white text-sm">person</mat-icon>
    </div>
  </div>
</header>
<!-- Sidebar -->
<aside class="fixed left-0 top-16 bottom-0 w-16 bg-blue-600 flex flex-col items-center py-4 z-40">
  <!-- Navigation Items -->
  <div class="flex flex-col gap-4">
    <button mat-icon-button class="!w-10 !h-10 !rounded-lg !bg-blue-700 !text-white hover:!bg-blue-500 transition-colors">
      <mat-icon class="text-lg">grid_view</mat-icon>
    </button>
    <button mat-icon-button class="!w-10 !h-10 !rounded-lg !text-blue-200 hover:!bg-blue-500 transition-colors">
      <mat-icon class="text-lg">schedule</mat-icon>
    </button>
    <button mat-icon-button class="!w-10 !h-10 !rounded-lg !text-blue-200 hover:!bg-blue-500 transition-colors">
      <mat-icon class="text-lg">chat</mat-icon>
    </button>
    <button mat-icon-button class="!w-10 !h-10 !rounded-lg !text-blue-200 hover:!bg-blue-500 transition-colors">
      <mat-icon class="text-lg">people</mat-icon>
    </button>
    <button mat-icon-button class="!w-10 !h-10 !rounded-lg !text-blue-200 hover:!bg-blue-500 transition-colors">
      <mat-icon class="text-lg">settings</mat-icon>
    </button>
    <button mat-icon-button class="!w-10 !h-10 !rounded-lg !text-blue-200 hover:!bg-blue-500 transition-colors">
      <mat-icon class="text-lg">extension</mat-icon>
    </button>
  </div>

  <!-- Bottom Help Icon -->
  <div class="mt-auto">
    <button mat-icon-button class="!w-10 !h-10 !rounded-full !border-2 !border-blue-300 !text-blue-200 hover:!bg-blue-500 transition-colors">
      <mat-icon class="text-lg">help_outline</mat-icon>
    </button>
  </div>
</aside>
<main class="ml-16 mt-16 h-screen overflow-hidden">
<div class="edit-page-container bg-gray-50 min-h-screen p-6">
  <div class="max-w-full mx-auto bg-white rounded-lg shadow-lg p-6">
    <!-- Page Header -->
    <!-- <div class="flex justify-between items-center mb-6 border-b border-gray-200 pb-4">
      <h4 class="text-lg font-semibold text-gray-800">Media Block</h4>
      <div class="flex gap-2"> -->
        <!-- <button mat-flat-button
                class="!bg-blue-500 hover:!bg-blue-600 !text-white !rounded-lg px-6 py-2 font-medium"
                (click)="saveMedia()">
          Save
        </button> -->
        <!-- <button mat-icon-button [routerLink]="['/media-blocks']" class="text-gray-500 hover:text-gray-700">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div> -->

    <div class="page-content">
      <!-- <p class="text-sm text-gray-600 mb-6">
        Define the content that your chatbot will deliver, whether it's a text message, an image, a video, or any other type of media.
      </p> -->

      <!-- Create/Edit Media Form -->
      <div class="define-media-config">
        <!-- Media Name -->
        <div class="flex !justify-end gap-3 mb-6">
  <input type="text" 
         [(ngModel)]="selectedMedia.name" 
         placeholder="Media Block Name" style="width: 400px;"
         class="px-4 py-2 border border-gray-300 rounded-md text-base font-medium text-gray-800 w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
  <button mat-flat-button
          class="!bg-blue-500 hover:!bg-blue-600 !text-white !rounded-lg px-6 py-2 font-medium"
          (click)="saveMedia()">
    Save
  </button>
</div>

        <!-- Media Type Toggle -->
         <div class="centered-container">
  <mat-button-toggle-group 
    name="mediaType" 
    [(ngModel)]="selectedMedia.type" 
    (ngModelChange)="onMediaTypeChange($event)" 
    class="flex flex-wrap !border !border-gray-300 !justify-center !rounded-lg !items-center mb-6 w-200">
    <mat-button-toggle value="text" class="flex-1 px-4 py-1 text-center text-sm">TEXT MESSAGE</mat-button-toggle>
    <mat-button-toggle value="Image Slider" class="flex-1 px-4 py-1 text-center text-sm">IMAGE SLIDER</mat-button-toggle>
    <mat-button-toggle value="image" class="flex-1 px-4 py-1 text-center text-sm">IMAGE</mat-button-toggle>
    <mat-button-toggle value="video" class="flex-1 px-4 py-1 text-center text-sm">VIDEO</mat-button-toggle>
    <mat-button-toggle value="audio" class="flex-1 px-4 py-1 text-center text-sm">AUDIO</mat-button-toggle>
    <mat-button-toggle value="file" class="flex-1 px-4 py-1 text-center text-sm">FILE</mat-button-toggle>
  </mat-button-toggle-group>
</div>

        <!-- Phone Frame Container -->
        <div class="phone-frame-container flex justify-center mb-6">
         <div class="relative bg-black rounded-3xl-custom p-phone-bezel shadow-2xl-custom phone-half-frame-height">
        <img
    src="https://app.botsify.com/theme/images/apple-iphone-x-landing-page-blank-png-22.png"
    alt="iPhone Frame"
    class="absolute top-0 left-0 w-full h-full z-10 pointer-events-none"
  />
            <div class="bg-white rounded-2xl h-full flex flex-col relative overflow-hidden">
              <!-- Phone Status Bar -->
              <div class="flex justify-between items-center px-4 py-2 text-xs font-medium text-black bg-white">
                <span>9:41</span>
                <div class="flex items-center gap-1">
                  <!-- Status icons -->
                </div>
              </div>

              <!-- Phone Content Area -->
              <div class="flex-1 px-4 pb-8 flex flex-col justify-center bg-gray-100">
            <div class="bg-transparent rounded-2xl p-4 justify-center max-w-[85%] self-center  mt-[-500px]">
                  <!-- Text Content -->
                  <div *ngIf="selectedMedia.type === 'text'">
                    <mat-form-field appearance="outline" class="w-full">
                      <input matInput 
                             [(ngModel)]="selectedMedia.content"
                             placeholder="Type message you want to send..." 
                             class="text-sm text-gray-700" />
                      <mat-icon matSuffix class="text-gray-500">emoji_emotions</mat-icon>
                    </mat-form-field>
                  </div>

                  <!-- Image Upload -->
                  <div *ngIf="selectedMedia.type === 'image'" class="image-upload-container">
                    <div class="image-display-area relative bg-gray-200 rounded-lg flex flex-col items-center justify-center h-40 mb-3 border-2 border-dashed border-gray-300 overflow-hidden">
                      <!-- Upload Prompt -->
                      <div class="upload-content text-center cursor-pointer p-4 w-full h-full flex items-center justify-center"
                           [class.hidden]="selectedMedia.url" 
                           (click)="openUploadModal('image')">
                        <div class="flex flex-col items-center justify-center">
                          <div class="upload-icon mb-2">
                            <div class="w-8 h-8 mx-auto bg-blue-500 rounded-full flex items-center justify-center">
                              <mat-icon class="text-white text-lg">image</mat-icon>
                            </div>
                          </div>
                          <p class="text-gray-600 text-sm font-medium mb-1">Drag your image here or click</p>
                          <p class="text-gray-600 text-sm font-medium">to upload</p>
                        </div>
                      </div>

                      <!-- Image Display -->
                      <div class="image-display w-full h-full" *ngIf="selectedMedia.url">
                        <img [src]="selectedMedia.url" 
                             alt="Image Preview" 
                             class="w-full h-full object-cover rounded-lg">
                        <button class="absolute top-2 right-2 w-6 h-6 rounded-lg flex items-center justify-center bg-red-500 bg-opacity-80 text-white hover:bg-opacity-100 transition-colors shadow-md z-20"
                                (click)="removeMedia()">
                          <mat-icon class="text-xs">delete</mat-icon>
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- Video Upload -->
                  <div *ngIf="selectedMedia.type === 'video'" class="video-upload-container">
                    <div class="relative bg-gray-900 rounded-lg overflow-hidden mb-4 h-48">
                      <!-- Default Video Display -->
                      
                         <div 
        *ngIf="!selectedMedia.url"
        class="w-80 h-full flex items-center justify-center bg-gradient-to-br from-gray-800 to-gray-900">
        
        <!-- Large Play Button -->
        <div class="w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center">
          <div class="w-0 h-0 border-l-[20px] border-l-gray-800 border-t-[12px] border-t-transparent border-b-[12px] border-b-transparent ml-1"></div>
        </div>
        
        <!-- Video Controls Bar (Default) -->
        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-3">
          <div class="flex items-center gap-3 text-white text-sm">
            <div class="w-0 h-0 border-l-[12px] border-l-white border-t-[7px] border-t-transparent border-b-[7px] border-b-transparent"></div>
            <span>0:00</span>
            <div class="flex-1 h-1 bg-white bg-opacity-30 rounded-full"></div>
            <div class="w-4 h-4 rounded-full border border-white flex items-center justify-center">
              <div class="w-2 h-2 bg-white rounded-full"></div>
            </div>
            <div class="w-4 h-4 flex items-center justify-center">
              <svg class="w-3 h-3 fill-white" viewBox="0 0 24 24">
                <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
              </svg>
            </div>
            <div class="w-4 h-4 flex items-center justify-center">
              <svg class="w-3 h-3 fill-white" viewBox="0 0 24 24">
                <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
              </svg>
            </div>
            <div class="w-4 h-4 flex items-center justify-center">
              <svg class="w-2 h-2 fill-white" viewBox="0 0 24 24">
                <circle cx="5" cy="12" r="2"/>
                <circle cx="12" cy="12" r="2"/>
                <circle cx="19" cy="12" r="2"/>
              </svg>
            </div>
          </div>
        </div>
      </div>
                     

                      <!-- Video Display -->
                      <div *ngIf="selectedMedia.url" class="relative w-full h-full">
                        <video [src]="selectedMedia.url" controls class="w-full h-full object-cover"></video>
                        <button class="absolute top-2 right-2 w-6 h-6 rounded-lg flex items-center justify-center bg-red-500 bg-opacity-80 text-white hover:bg-opacity-100 transition-colors shadow-md z-20"
                                (click)="removeVideoMedia()">
                          <mat-icon class="text-xs">delete</mat-icon>
                        </button>
                      </div>
                    </div>

                     <button 
      class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-1.5 px-6 rounded-lg flex items-center justify-center gap-3 transition-colors"
      (click)="openUploadModal('video')">
      <span class="text-xl">+</span>
      <span>Upload Video</span>
    </button>
                  </div>

                  <!-- Audio Upload -->
                  <div *ngIf="selectedMedia.type === 'audio'" class="audio-upload-container">
                    <div class="relative bg-white rounded-lg overflow-hidden mb-4 h-32">
                      <!-- Audio Player -->
                      <div *ngIf="selectedMedia.url" class="w-full h-full flex items-center justify-center p-4" style="height: 120px; width: 400px;">
                        <audio controls [src]="selectedMedia.url" class="w-full max-w-full">
                          Your browser does not support the audio element.
                        </audio>
                        <button class="absolute top-2 right-2 w-6 h-6 rounded-lg flex items-center justify-center bg-red-500 bg-opacity-80 text-white hover:bg-opacity-100 transition-colors shadow-md z-20"
                                (click)="removeAudioMedia()">
                          <mat-icon class="text-xs">delete</mat-icon>
                        </button>
                      </div>
                      
                      <!-- Default Audio Display -->
                      <div *ngIf="!selectedMedia.url" class="w-full h-full flex items-center justify-center bg-gray-100">
                        <div class="flex flex-col items-center text-gray-500">
                          <mat-icon class="text-3xl mb-2">volume_up</mat-icon>
                          <span class="text-sm">No audio file</span>
                        </div>
                      </div>
                    </div>

                    <button class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-1.5 px-6 rounded-lg flex items-center justify-center gap-3 transition-colors"
                            (click)="triggerAudioUpload()">
                      <span class="text-xl">+</span>
                      <span>Upload Audio</span>
                    </button>
                  </div>

                  <!-- File Upload -->
                  <div *ngIf="selectedMedia.type === 'file'" class="file-upload-container">
                    <div *ngIf="!selectedMedia.url" class="w-full h-48 flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 mb-4 p-4">
                      <mat-icon class="text-gray-400 text-4xl mb-2">cloud_upload</mat-icon>
                      <span class="text-sm text-gray-500 italic">Please Upload File</span>
                      <button mat-flat-button class="!bg-blue-500 !text-white mt-4" (click)="triggerFileUpload()">
                        Upload File
                      </button>
                    </div>

                    <div *ngIf="selectedMedia.url" class="w-full h-24 flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 mb-4 p-4 relative">
                      <div class="flex items-center gap-2">
                        <mat-icon class="text-gray-400 text-2xl">description</mat-icon>
                        <span class="text-base text-gray-700">{{ uploadedFileName || 'uploaded-file.pdf' }}</span>
                      </div>
                      <button mat-icon-button (click)="removeFile()" class="absolute top-2 right-2 text-gray-500 hover:text-gray-900">
                        <mat-icon>close</mat-icon>
                      </button>
                    </div>
                  </div>

                  <!-- Image Slider -->
                  <div *ngIf="selectedMedia.type === 'Image Slider'" class="image-slider-container">
                    <div class="slider-controls absolute top-30 right-30 flex space-x-2 z-10">
                      <button *ngIf="selectedMedia.slides && selectedMedia.slides.length > 1"
                              class="w-6 h-6 rounded-lg flex items-center justify-center bg-red-500 text-white hover:bg-red-600 transition-colors shadow-md"
                              (click)="removeCurrentSlide()">
                        <mat-icon class="text-xs">close</mat-icon>
                      </button>
                    </div>

                    <div class="slider-content" *ngIf="selectedMedia.slides && selectedMedia.slides.length > 0">
                      <div class="current-slide-content" [@slideAnimation]="currentSlideIndex">
                        <div class="relative flex items-center">
                          <!-- Left Navigation -->
                          <button class="absolute left-[-40px] top-1/2 transform -translate-y-1/2 w-6 h-6 rounded-lg flex items-center justify-center bg-blue-500 bg-opacity-70 text-white hover:bg-opacity-90 transition-colors shadow-md z-10"
                                  (click)="previousSlide()" 
                                  [disabled]="currentSlideIndex === 0">
                            <mat-icon class="text-sm">chevron_left</mat-icon>
                          </button>

                          <!-- Image Display Area -->
                          <div class="image-display-area relative bg-gray-200 rounded-lg flex flex-col items-center justify-center h-40 mb-3 border-2 border-dashed border-gray-300 overflow-hidden w-full">
                            <!-- Upload Prompt -->
                            <div class="upload-content text-center cursor-pointer p-4 w-full h-full flex items-center justify-center"
                                 [class.hidden]="selectedMedia.slides[currentSlideIndex].image" 
                                 (click)="openUploadModal('image')">
                              <div class="flex flex-col items-center justify-center">
                                <div class="upload-icon mb-2">
                                  <div class="w-8 h-8 mx-auto bg-blue-500 rounded-full flex items-center justify-center">
                                    <mat-icon class="text-white text-lg">image</mat-icon>
                                  </div>
                                </div>
                                <p class="text-gray-600 text-sm font-medium mb-1">Drag your image here or click</p>
                                <p class="text-gray-600 text-sm font-medium">to upload</p>
                              </div>
                            </div>

                            <!-- Slide Image Display -->
                            <div class="image-slider-display w-full h-full" *ngIf="selectedMedia.slides[currentSlideIndex].image">
                              <img [src]="selectedMedia.slides[currentSlideIndex].image" 
                                   alt="Slide Image" 
                                   class="w-full h-full object-cover rounded-lg">
                              <button class="absolute top-2 right-2 w-6 h-6 rounded-lg flex items-center justify-center bg-red-500 bg-opacity-80 text-white hover:bg-opacity-100 transition-colors shadow-md z-20"
                                      (click)="removeCurrentImage(currentSlideIndex)">
                                <mat-icon class="text-xs">delete</mat-icon>
                              </button>
                            </div>
                          </div>

                          <!-- Right Navigation / Add Slide -->
                          <button *ngIf="currentSlideIndex < (selectedMedia.slides.length - 1); else addSlideButton"
                                  class="absolute right-[-40px] top-1/2 transform -translate-y-1/2 w-6 h-6 rounded-lg flex items-center justify-center bg-blue-500 bg-opacity-70 text-white hover:bg-opacity-90 transition-colors shadow-md z-10"
                                  (click)="nextSlide()">
                            <mat-icon class="text-sm">chevron_right</mat-icon>
                          </button>

                          <ng-template #addSlideButton>
                            <button class="absolute right-[-40px] top-1/2 transform -translate-y-1/2 w-6 h-6 rounded-lg flex items-center justify-center bg-blue-500 bg-opacity-70 text-white hover:bg-opacity-90 transition-colors shadow-md z-10"
                                    (click)="addNewSlide()">
                              <mat-icon class="text-sm">add</mat-icon>
                            </button>
                          </ng-template>
                        </div>

                        <!-- Slide Title Input -->
                        <div class="slide-input-group mb-3">
                          <input type="text" 
                                 placeholder="Slide Title"
                                 class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm font-medium text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                 [(ngModel)]="selectedMedia.slides[currentSlideIndex].title" />
                        </div>

                        <!-- Slide Subtitle Input -->
                        <div class="slide-input-group mb-3">
                          <input type="text" 
                                 placeholder="Subtitle"
                                 class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                 [(ngModel)]="selectedMedia.slides[currentSlideIndex].subtitle" />
                        </div>
                      </div>

                      <!-- Slide Indicators -->
                      <div class="slide-indicators flex justify-center gap-1 mt-4">
                        <div class="indicator w-2 h-2 rounded-full bg-gray-400 cursor-pointer transition-colors"
                             *ngFor="let slide of selectedMedia.slides; let i = index"
                             [class.bg-blue-500]="i === currentSlideIndex" 
                             (click)="goToSlide(i)">
                        </div>
                      </div>
                    </div>

                    <!-- Empty Slider State -->
                    <div class="image-slider-container bg-white rounded-lg p-3 mb-3"
                         *ngIf="!selectedMedia.slides || selectedMedia.slides.length === 0">
                      <div class="upload-content text-center cursor-pointer" (click)="addNewSlide()">
                        <p class="text-gray-600 text-sm font-medium mb-1">Click to add your first slide</p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Buttons Section -->
                <div *ngIf="selectedMedia.buttons && selectedMedia.buttons.length" class="buttons-section mt-4">
                  <div *ngFor="let button of selectedMedia.buttons; let i = index" class="mb-2 flex justify-center">
                    <button class="bg-transparent text-blue-500 py-1 px-2 w-50 max-w-xs rounded-lg text-xs font-semibold flex items-center justify-between border border-blue-500 hover:bg-gray-100 transition-colors">
                      <mat-icon class="text-sm" (click)="onEditButtonClick(button, i)">edit</mat-icon>
                      <span class="flex-1 px-4">{{ button.title }}</span>
                      <mat-icon class="text-sm text-red-500" (click)="onDeleteButtonClick(i)">delete</mat-icon>
                    </button>
                  </div>
                </div>

                <!-- Add Button -->
                <div class="add-button-section mb-4 flex justify-center">
                  <button class="bg-transparent text-blue-500 px-10 py-1 text-xs font-semibold flex items-center gap-2 hover:bg-blue-200 transition-colors border-2 border-dashed border-blue-300 rounded"
                          (click)="onAddNewButton()">
                    <span class="text-base font-bold">+</span>
                    ADD NEW BUTTON
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Upload Modal -->
  <div *ngIf="showUploadModal" class="fixed inset-0 z-50 flex items-center justify-center  bg-opacity-50">
    <div class="bg-white w-full max-w-md rounded-lg shadow-lg">
      <div class="flex justify-between items-center p-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-800">
          {{ activeMediaType === 'image' ? 'Upload Image' : activeMediaType === 'video' ? 'Upload Video' : 'Upload File' }}
        </h3>
        <button mat-icon-button (click)="closeUploadModal()" class="text-gray-500 hover:text-gray-700">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <mat-tab-group class="upload-tabs">
        <mat-tab label="Upload">
          <div class="p-4">
            <div class="flex gap-2 items-center justify-between p-4 rounded-lg">
              <button class="w-full py-2 text-sm text-gray-600 border border-gray-300 rounded truncate">
                {{ uploadedFileName || 'Choose file' }}
              </button>

              <ng-container *ngIf="activeMediaType === 'image'">
                <input #imageUploadInput type="file" accept="image/*" class="hidden" (change)="onImageUpload($event)">
                <button mat-flat-button class="!bg-green-500 !text-white !rounded-lg" (click)="imageUploadInput.click()">
                  Browse
                </button>
              </ng-container>

              <ng-container *ngIf="activeMediaType === 'video'">
                <input #videoUploadInput type="file" accept="video/*" class="hidden" (change)="onVideoUpload($event)">
                <button mat-flat-button class="!bg-green-500 !text-white !rounded-lg" (click)="videoUploadInput.click()">
                  Browse
                </button>
              </ng-container>

              <ng-container *ngIf="activeMediaType === 'file'">
                <input #fileUploadInput type="file" class="hidden" (change)="onFileUpload($event)">
                <button mat-flat-button class="!bg-green-500 !text-white !rounded-lg" (click)="fileUploadInput.click()">
                  Browse
                </button>
              </ng-container>
            </div>
          </div>
        </mat-tab>

        <mat-tab label="URL">
          <div class="p-4">
            <h3 class="block text-gray-700 text-sm font-medium mb-2">
              {{ activeMediaType === 'image' ? 'Image URL' : activeMediaType === 'video' ? 'Video URL' : 'File URL' }}
            </h3>
            <mat-form-field appearance="outline" class="w-full">
              <input matInput
                     [placeholder]="activeMediaType === 'image' ? 'https://example.com/image.jpg' : activeMediaType === 'video' ? 'https://example.com/video.mp4' : 'https://example.com/file.pdf'"
                     [ngModel]="activeMediaType === 'image' ? imageUrlInput : videoUrlInput"
                     (ngModelChange)="activeMediaType === 'image' ? imageUrlInput = $event : videoUrlInput = $event">
            </mat-form-field>
            <div class="flex justify-end mt-2">
              <button mat-flat-button class="!bg-green-500 !text-white !rounded-lg"
                      (click)="activeMediaType === 'image' ? uploadImageUrl() : uploadVideoUrl()">
                Upload
              </button>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>

  <!-- Button Type Selection Card -->
  <div class="button-type-card fixed z-50 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2" *ngIf="showButtonTypeCard">
    <div class="bg-gray-50 p-6 rounded-lg shadow-xl w-80 max-w-full">
      <div class="flex justify-between items-center mb-4">
        <h4 class="text-lg font-semibold text-gray-800">Button Type</h4>
        <button mat-icon-button (click)="closeButtonTypeCard()" class="text-gray-500 hover:text-gray-700">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="grid grid-cols-2 gap-3">
        <button mat-flat-button class="!text-xs py-2 !rounded-lg !bg-blue-500 !text-white hover:!bg-blue-600"
                (click)="openCommonCardForNewButton('text_message')">Text Message</button>
        <button mat-flat-button class="!text-xs py-2 !rounded-lg !bg-blue-500 !text-white hover:!bg-blue-600"
                (click)="openCommonCardForNewButton('media_block')">Send Media Block</button>
        <button mat-flat-button class="!text-xs py-2 !rounded-lg !bg-blue-500 !text-white hover:!bg-blue-600"
                (click)="openCommonCardForNewButton('website_url')">Website URL</button>
        <button mat-flat-button class="!text-xs py-2 !rounded-lg !bg-blue-500 !text-white hover:!bg-blue-600"
                (click)="openCommonCardForNewButton('direct_call')">Direct Call</button>
        <button mat-flat-button class="!text-xs py-2 !rounded-lg !bg-blue-500 !text-white hover:!bg-blue-600"
                (click)="openCommonCardForNewButton('start_story')">Start Story</button>
        <button mat-flat-button class="!text-xs py-2 !rounded-lg !bg-blue-500 !text-white hover:!bg-blue-600"
                (click)="openCommonCardForNewButton('rss_feed')">RSS Feed</button>
        <button mat-flat-button class="!text-xs py-2 !rounded-lg !bg-blue-500 !text-white hover:!bg-blue-600"
                (click)="openCommonCardForNewButton('json_api')">JSON API</button>
        <button mat-flat-button class="!text-xs py-2 !rounded-lg !bg-blue-500 !text-white hover:!bg-blue-600"
                (click)="openCommonCardForNewButton('human_help')">Human Help</button>
        <button mat-flat-button class="!text-xs py-2 !rounded-lg !bg-blue-500 !text-white hover:!bg-blue-600"
                (click)="openCommonCardForNewButton('conversational_form')">Conversational Form</button>
      </div>
    </div>
  </div>

  <!-- Button Integration Card -->
  <div class="common-integration-card fixed z-50 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 p-4 bg-white rounded-lg shadow-xl border border-gray-200"
       *ngIf="showCommonIntegrationCard">
    <div class="flex justify-between items-center mb-4">
      <h4 class="text-lg font-medium uppercase text-gray-500">
        <ng-container [ngSwitch]="currentButton.type">
          <span *ngSwitchCase="'text_message'">Text Message Integration</span>
          <span *ngSwitchCase="'media_block'">Media Block Integration</span>
          <span *ngSwitchCase="'website_url'">Website URL Integration</span>
          <span *ngSwitchCase="'direct_call'">Direct Call Integration</span>
          <span *ngSwitchCase="'start_story'">Story Integration</span>
          <span *ngSwitchCase="'rss_feed'">RSS Integration</span>
          <span *ngSwitchCase="'json_api'">JSON Integration</span>
          <span *ngSwitchCase="'human_help'">Human Help Integration</span>
          <span *ngSwitchCase="'conversational_form'">Conversational Form Integration</span>
          <span *ngSwitchDefault>Button Integration</span>
        </ng-container>
      </h4>
      <button mat-icon-button (click)="closeCommonIntegrationCard()" class="text-gray-500 hover:text-gray-700">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Button Title -->
    <div class="input-group mb-4">
      <h3 class="text-sm mb-1 font-semibold text-gray-600">Title of the button *</h3>
      <mat-form-field appearance="outline" class="w-full">
        <textarea matInput 
                  placeholder="e.g. Show another product" 
                  [(ngModel)]="currentButton.title" 
                  maxlength="20"
                  cdkTextareaAutosize 
                  #buttonTitleAutosize="cdkTextareaAutosize" 
                  cdkAutosizeMinRows="1" 
                  cdkAutosizeMaxRows="2"
                  class="resize-none"></textarea>
        <mat-hint align="end">{{ currentButton.title ? currentButton.title.length : 0 }} / 20</mat-hint>
      </mat-form-field>
    </div>

    <!-- Button Content Based on Type -->
    <ng-container [ngSwitch]="currentButton.type">
      <!-- Text Message -->
      <div *ngSwitchCase="'text_message'" class="input-group mb-4">
        <h3 class="text-sm mb-1 font-semibold text-gray-600">Bot says *</h3>
        <mat-form-field appearance="outline" class="w-full">
          <textarea matInput 
                    placeholder="Welcome, I am Leo, I can help you discover cheapest concert tickets" 
                    rows="2"
                    [(ngModel)]="currentButton.textMessage" 
                    maxlength="320" 
                    cdkTextareaAutosize
                    #buttonTextMessageAutosize="cdkTextareaAutosize" 
                    cdkAutosizeMinRows="2" 
                    cdkAutosizeMaxRows="8"
                    class="max-h-20 overflow-y-auto resize-none"></textarea>
          <mat-hint align="end">{{ currentButton.textMessage ? currentButton.textMessage.length : 0 }} / 320</mat-hint>
          <mat-icon matSuffix class="info-icon cursor-pointer" (click)="openInfoModal('buttonTextMessage')">info</mat-icon>
        </mat-form-field>
      </div>

      <!-- Media Block Selection -->
      <div *ngSwitchCase="'media_block'" class="input-group mb-4">
        <h3 class="text-sm mb-1 font-semibold text-gray-600">Select Media Block *</h3>
        <mat-form-field appearance="outline" class="w-full">
          <mat-select [(ngModel)]="currentButton.linkedMediaId">
            <mat-option [value]="undefined">No media block selected</mat-option>
            <mat-option *ngFor="let media of availableMedia" [value]="media.id">
              {{ media.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Website URL -->
      <div *ngSwitchCase="'website_url'" class="input-group mb-4">
        <h3 class="text-sm mb-1 font-semibold text-gray-600">Weblink on button click *</h3>
        <mat-form-field appearance="outline" class="w-full">
          <input matInput placeholder="e.g. https://www.example.com" [(ngModel)]="currentButton.url">
        </mat-form-field>
      </div>

      <!-- Direct Call -->
      <div *ngSwitchCase="'direct_call'" class="input-group mb-4">
        <h3 class="text-sm mb-1 font-semibold text-gray-600">Phone number *</h3>
        <mat-form-field appearance="outline" class="w-full">
          <input matInput placeholder="e.g. +15105551234" [(ngModel)]="currentButton.phoneNumber">
        </mat-form-field>
      </div>

      <!-- Start Story -->
      <div *ngSwitchCase="'start_story'" class="input-group mb-4">
        <h3 class="text-sm mb-1 font-semibold text-gray-600">Select story to initiate *</h3>
        <mat-form-field appearance="outline" class="w-full">
          <mat-select [(ngModel)]="currentButton.storyId">
            <mat-option [value]="undefined">No story selected</mat-option>
            <mat-option *ngFor="let story of availableStories" [value]="story.id">
              {{ story.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- RSS Feed -->
      <ng-container *ngSwitchCase="'rss_feed'">
        <div class="input-group mb-4">
          <h3 class="text-sm mb-1 font-semibold text-gray-600">RSS Feed URL *</h3>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput placeholder="Your RSS feed URL" [(ngModel)]="currentButton.rssUrl">
          </mat-form-field>
        </div>

        <div class="input-group mb-4">
          <h3 class="text-sm mb-1 font-semibold text-gray-600">Number of items to show *</h3>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput type="number" placeholder="e.g. 5" [(ngModel)]="currentButton.rssItemCount">
          </mat-form-field>
        </div>

        <div class="input-group mb-4">
          <h3 class="text-sm mb-1 font-semibold text-gray-600">Button Text *</h3>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput placeholder="e.g. View Now!" [(ngModel)]="currentButton.rssButtonText">
          </mat-form-field>
        </div>
      </ng-container>

      <!-- JSON API -->
      <ng-container *ngSwitchCase="'json_api'">
        <div class="input-group mb-4">
          <h3 class="text-sm mb-1 font-semibold text-gray-600">API Endpoint *</h3>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput type="url" [(ngModel)]="currentButton.apiEndpoint" placeholder="Enter Your API Endpoint" />
          </mat-form-field>
        </div>

        <div class="input-group mb-4">
          <h3 class="text-sm mb-1 font-semibold text-gray-600">Select Request Type *</h3>
          <mat-form-field appearance="outline" class="w-full">
            <mat-select [(ngModel)]="currentButton.requestType" placeholder="Select Request Type">
              <mat-option value="POST">POST</mat-option>
              <mat-option value="GET">GET</mat-option>
              <mat-option value="PUT">PUT</mat-option>
              <mat-option value="DELETE">DELETE</mat-option>
              <mat-option value="PATCH">PATCH</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="headers-section mb-4">
          <h4 class="font-semibold text-sm text-gray-600 mb-2">Select Headers</h4>
          
          <div class="header-item flex items-center gap-2 mb-2" *ngFor="let header of currentButton.apiHeaders; let i = index">
            <mat-form-field appearance="outline" class="flex-1">
              <input matInput [(ngModel)]="header.key" placeholder="Header Key" />
            </mat-form-field>

            <mat-form-field appearance="outline" class="flex-1">
              <input matInput [(ngModel)]="header.value" placeholder="Header Value" />
            </mat-form-field>

            <button mat-icon-button color="warn" (click)="removeApiHeader(i)" matTooltip="Remove Header">
              <mat-icon>delete</mat-icon>
            </button>
          </div>

          <button mat-flat-button class="!bg-blue-500 !text-white w-full" (click)="addApiHeader()">
            <mat-icon>add</mat-icon>
            Add Header
          </button>
        </div>
      </ng-container>

      <!-- Human Help -->
      <ng-container *ngSwitchCase="'human_help'">
        <div class="input-group mb-4">
          <h3 class="text-sm mb-1 font-semibold text-gray-600">Message After Help Action *</h3>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput placeholder="Bot Says" [(ngModel)]="currentButton.messageAfterAction">
          </mat-form-field>
        </div>

        <div class="input-group mb-4">
          <h3 class="text-sm mb-1 font-semibold text-gray-600">Email for Notification</h3>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput placeholder="Enter Email" [(ngModel)]="currentButton.emailForNotification">
          </mat-form-field>
          <p class="text-xs text-gray-500 mt-1">Note: Send notifications to multiple emails, press enter to add email.</p>
        </div>

        <div class="flex items-center mt-4">
          <mat-slide-toggle [(ngModel)]="currentButton.stopBotForUser" class="mr-2"></mat-slide-toggle>
          <span>Stop Bot For User</span>
        </div>
      </ng-container>

      <!-- Conversational Form -->
      <ng-container *ngSwitchCase="'conversational_form'">
        <div class="input-group mb-4">
          <h3 class="text-sm mb-1 font-semibold text-gray-600">Select Form *</h3>
          <mat-form-field appearance="outline" class="w-full">
            <mat-select [(ngModel)]="currentButton.formId">
              <mat-option value="form1">Default Form 9405</mat-option>
              <mat-option value="form2">Another Form</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="flex items-center mt-4">
          <mat-slide-toggle [(ngModel)]="currentButton.showInline"></mat-slide-toggle>
          <span class="ml-2">Show as inline form</span>
          <mat-icon matTooltip="Display the form directly in the chat window." class="ml-1 text-gray-500">info</mat-icon>
        </div>
      </ng-container>
    </ng-container>

    <!-- Save Button -->
    <div class="flex justify-start mt-6">
      <button mat-flat-button
              class="!bg-blue-500 !text-white h-8 px-4 !rounded-lg font-medium"
              (click)="saveCommonIntegrationCard()">
        {{ currentButtonIndex === -1 ? 'Add' : 'Update' }}
      </button>
    </div>
  </div>

  <!-- Info Modal for Variables -->
  <div class="info-modal fixed z-[60] top-0 left-0 w-full h-full flex items-center justify-center" 
       *ngIf="showInfoModal" 
       (click)="closeInfoModal()">
    <div class="info-modal-card bg-white border p-4 rounded-lg shadow-xl w-80 max-w-full" 
         (click)="$event.stopPropagation()">
      <!-- Search Box -->
      <div class="search-box mb-4">
        <mat-form-field appearance="outline" class="w-full">
          <input matInput 
                 placeholder="search variable..." 
                 type="text" 
                 [(ngModel)]="searchTerm"
                 (ngModelChange)="filterVariables()">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>
      </div>

      <!-- Variable Lists -->
      <div class="variable-lists max-h-64 overflow-y-auto">
        <!-- General Attributes -->
        <div class="variable-list-group mb-4" *ngIf="filteredGeneralAttributes.length > 0">
          <h5 class="text-xs font-medium text-gray-700 mb-2">General Attributes</h5>
          <div class="grid grid-cols-2 gap-2">
            <button mat-flat-button
                    class="!justify-start !text-xs !text-blue-500 py-1 !rounded-lg !bg-blue-100 !border !border-blue-300 hover:!bg-blue-200"
                    *ngFor="let attr of filteredGeneralAttributes" 
                    (click)="selectVariable(attr)">
              {{ attr }}
            </button>
          </div>
        </div>

        <!-- Form Attributes -->
        <div class="variable-list-group mb-4" *ngIf="filteredFormAttributes.length > 0">
          <h5 class="text-xs font-medium text-gray-700 mb-2">Form Attributes</h5>
          <div class="grid grid-cols-1 gap-2">
            <button mat-flat-button
                    class="!justify-start !text-xs !text-blue-500 py-1 !rounded-lg !bg-blue-100 !border !border-blue-300 hover:!bg-blue-200"
                    *ngFor="let attr of filteredFormAttributes" 
                    (click)="selectVariable(attr)">
              {{ attr }}
            </button>
          </div>
        </div>

        <!-- User Attributes -->
        <div class="variable-list-group mb-4" *ngIf="filteredUserAttributes.length > 0">
          <h5 class="text-xs font-medium text-gray-700 mb-2">User Attributes</h5>
          <div class="grid grid-cols-2 gap-2">
            <button mat-flat-button
                    class="!justify-start !text-xs !text-blue-500 py-1 !rounded-lg !bg-blue-100 !border !border-blue-300 hover:!bg-blue-200"
                    *ngFor="let attr of filteredUserAttributes" 
                    (click)="selectVariable(attr)">
              {{ attr }}
            </button>
          </div>
        </div>

        <!-- No Results -->
        <div *ngIf="filteredGeneralAttributes.length === 0 && filteredFormAttributes.length === 0 && filteredUserAttributes.length === 0">
          <p class="text-center text-xs text-gray-500 italic">No variables found.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Hidden File Inputs -->
<input type="file" #fileUploadInput style="display: none;" (change)="onFileUpload($event)">
<input type="file" #audioUploadInput accept="audio/*" style="display: none;" (change)="onAudioUpload($event)">
<input type="file" #videoUploadInput accept="video/*" style="display: none;" (change)="onVideoUpload($event)">
<input type="file" #imageUploadInput accept="image/*" style="display: none;" (change)="onImageUpload($event)">
</main>