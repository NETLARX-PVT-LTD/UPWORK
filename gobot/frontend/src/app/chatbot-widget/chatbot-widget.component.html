<!-- Updated chatbot-widget.component.html -->
<div class="chatbot-container" [ngClass]="{'landing-mode': isLandingPage, 'widget-mode': !isLandingPage}">
  
  <!-- Landing Page Layout -->
  <div class="w-full" *ngIf="isLandingPage">
    <div class="px-8 py-16 text-center text-white" [ngClass]="{
      'bg-gradient-to-br from-indigo-500 to-purple-700': backgroundStyle === 'gradient',
      'bg-indigo-600': backgroundStyle === 'plain-primary',
      'bg-gray-600': backgroundStyle === 'plain-secondary'
    }">
      <h1 class="text-4xl font-semibold mb-4">{{landingTitle}}</h1>
      <p class="text-xl opacity-90">{{landingDescription}}</p>
    </div>
    
    <!-- Landing Page Chat Widget -->
    <div class="max-w-3xl mx-auto -mt-8 relative bg-white rounded-2xl shadow-xl overflow-hidden">
      <div class="chat-header bg-gradient-to-br from-indigo-500 to-purple-700 text-white p-4 flex items-center gap-3" 
           [style.background]="'linear-gradient(135deg, ' + primaryColor + ', ' + darkenColor(primaryColor, 20) + ')'">
        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-xl">
          <span>ðŸ¤–</span>
        </div>
        <div>
          <h3 class="m-0 text-lg font-semibold">{{botName}}</h3>
          <span class="text-sm opacity-80">Online</span>
        </div>
      </div>
      
      <div class="chat-messages flex-1 overflow-y-auto p-4 bg-slate-50 h-96" #messagesContainer>
        <!-- Welcome Message -->
        <div class="flex gap-3 mb-4 items-end" *ngIf="messages.length === 0">
          <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-base shrink-0">
            <span>ðŸ¤–</span>
          </div>
          <div class="max-w-[70%]">
            <div class="p-3 bg-white text-gray-800 rounded-2xl rounded-bl-sm shadow-sm inline-block break-words">
              {{welcomeMessage}}
            </div>
            <div class="text-xs text-gray-400 mt-1 pl-1">
              {{getCurrentTime()}}
            </div>
          </div>
        </div>

        <!-- Messages -->
        <div class="flex gap-3 mb-4 items-end" 
             *ngFor="let message of messages" 
             [ngClass]="{'flex-row-reverse': message.isUser}">
          
          <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-base shrink-0" *ngIf="!message.isUser">
            <span>ðŸ¤–</span>
          </div>
          
          <div class="flex-1 max-w-[70%]" [ngClass]="{'text-right': message.isUser}">
            <div class="p-3 rounded-2xl break-words inline-block"
                 [ngClass]="{
                   'text-white rounded-br-sm': message.isUser, 
                   'bg-white text-gray-800 rounded-bl-sm shadow-sm': !message.isUser
                 }"
                 [style.background-color]="message.isUser ? primaryColor : ''">
              <span *ngIf="message.typing" class="flex items-center gap-1">
                <span class="typing-dot"></span>
                <span class="typing-dot" style="animation-delay: 0.2s;"></span>
                <span class="typing-dot" style="animation-delay: 0.4s;"></span>
              </span>
              <span *ngIf="!message.typing">{{message.text}}</span>
            </div>
            <div class="text-xs text-gray-400 mt-1 pl-1" [ngClass]="{'pr-1': message.isUser}">
              {{formatTime(message.timestamp)}}
            </div>
          </div>
          
          <div class="w-8 h-8 rounded-full flex items-center justify-center text-base shrink-0 text-white" 
               *ngIf="message.isUser"
               [style.background-color]="primaryColor">
            <span>ðŸ‘¤</span>
          </div>
        </div>
      </div>

      <!-- Input Area -->
      <div class="p-4 bg-white border-t border-gray-200">
        <div class="flex gap-3 items-center">
          <input type="text" 
                 [(ngModel)]="currentMessage"
                 (keyup.enter)="sendMessage()"
                 [placeholder]="inputPlaceholder"
                 [disabled]="isSending"
                 class="flex-1 p-3 border border-gray-300 rounded-full text-base outline-none bg-gray-50 focus:border-indigo-600 focus:bg-white">
          <button class="send-button" 
                  (click)="sendMessage()" 
                  [disabled]="!currentMessage.trim() || isSending"
                  [style.background-color]="primaryColor">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22,2 15,22 11,13 2,9"></polygon>
            </svg>
          </button>
        </div>
      </div>

      <!-- Branding -->
      <div class="text-center p-2 text-xs text-gray-400 bg-gray-50 border-t border-gray-100" *ngIf="showBranding">
        <span>Powered by YourChatbot</span>
      </div>
    </div>
  </div>

  <!-- Widget Mode Layout (for embedding on external sites) -->
  <div class="widget-layout" *ngIf="!isLandingPage">
    
    <!-- Floating Chat Icon (shown when minimized) -->
    <div class="floating-icon" 
         *ngIf="isMinimized"
         (click)="toggleMinimize()"
         [style.background-color]="primaryColor"
         [ngClass]="'position-' + position">
      <span class="text-2xl">ðŸ’¬</span>
      <!-- Unread Messages Badge -->
      <div class="unread-badge" *ngIf="unreadCount > 0">
        {{unreadCount > 9 ? '9+' : unreadCount}}
      </div>
    </div>

    <!-- Chat Widget (shown when maximized) -->
    <div class="chat-widget" 
         *ngIf="!isMinimized"
         [ngClass]="'position-' + position + ' size-' + size">
      
      <!-- Chat Header -->
      <div class="chat-header" [style.background]="'linear-gradient(135deg, ' + primaryColor + ', ' + darkenColor(primaryColor, 20) + ')'">
        <div class="flex items-center gap-3 flex-1">
          <div class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-base">
            <span>ðŸ¤–</span>
          </div>
          <div>
            <h3 class="m-0 text-base font-semibold text-white">{{botName}}</h3>
            <span class="text-xs text-white opacity-80">Online</span>
          </div>
        </div>
        
        <!-- Header Controls -->
        <div class="flex gap-1">
          <button class="header-btn" (click)="toggleMinimize()" title="Minimize">
            <span>âˆ’</span>
          </button>
          <button class="header-btn" (click)="toggleMinimize()" title="Close">
            <span>Ã—</span>
          </button>
        </div>
      </div>

      <!-- Messages Area -->
      <div class="chat-messages" #messagesContainer>
        <!-- Welcome Message -->
        <div class="flex gap-2 mb-4 items-end" *ngIf="messages.length === 0">
          <div class="w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center text-xs shrink-0">
            <span>ðŸ¤–</span>
          </div>
          <div class="max-w-[75%]">
            <div class="message-bubble bot-message">
              {{welcomeMessage}}
            </div>
            <div class="message-time">
              {{getCurrentTime()}}
            </div>
          </div>
        </div>

        <!-- Chat Messages -->
        <div class="flex gap-2 mb-4 items-end" 
             *ngFor="let message of messages" 
             [ngClass]="{'flex-row-reverse': message.isUser}">
          
          <div class="w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center text-xs shrink-0" *ngIf="!message.isUser">
            <span>ðŸ¤–</span>
          </div>
          
          <div class="flex-1 max-w-[75%]" [ngClass]="{'text-right': message.isUser}">
            <div class="message-bubble"
                 [ngClass]="message.isUser ? 'user-message' : 'bot-message'"
                 [style.background-color]="message.isUser ? primaryColor : ''">
              <span *ngIf="message.typing" class="typing-indicator">
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
              </span>
              <span *ngIf="!message.typing">{{message.text}}</span>
            </div>
            <div class="message-time" [ngClass]="{'text-right': message.isUser}">
              {{formatTime(message.timestamp)}}
            </div>
          </div>
          
          <div class="w-6 h-6 rounded-full flex items-center justify-center text-xs shrink-0 text-white" 
               *ngIf="message.isUser"
               [style.background-color]="primaryColor">
            <span>ðŸ‘¤</span>
          </div>
        </div>
      </div>

      <!-- Input Area -->
      <div class="chat-input">
        <div class="flex gap-2 items-center">
          <input type="text" 
                 [(ngModel)]="currentMessage"
                 (keyup.enter)="sendMessage()"
                 [placeholder]="inputPlaceholder"
                 [disabled]="isSending"
                 class="message-input">
          <button class="send-button" 
                  (click)="sendMessage()" 
                  [disabled]="!currentMessage.trim() || isSending"
                  [style.background-color]="primaryColor">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22,2 15,22 11,13 2,9"></polygon>
            </svg>
          </button>
        </div>
      </div>

      <!-- Branding -->
      <div class="chat-branding" *ngIf="showBranding">
        <span>Powered by YourChatbot</span>
      </div>
    </div>
  </div>
</div>