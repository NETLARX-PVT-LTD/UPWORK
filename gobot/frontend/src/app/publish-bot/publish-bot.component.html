<!-- src/app/publish-bot/publish-bot.component.html -->
<div class="max-w-7xl mx-auto p-4 md:p-8 bg-slate-50 min-h-screen font-sans">
  <!-- Header -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
    <h1 class="text-2xl text-gray-900 font-bold mb-4 md:mb-0">Publish Bot</h1>
    <div class="flex items-center gap-2 bg-white px-4 py-2 rounded-lg shadow-sm">
      <span class="text-gray-700">Bot</span>
      <select [(ngModel)]="selectedBotId" class="border-none bg-transparent text-indigo-600 font-medium cursor-pointer focus:outline-none">
        <option value="bot1">Bot 1</option>
        <option value="bot2">Bot 2</option>
        <option value="bot3">Bot 3</option>
      </select>
    </div>
  </div>

  <div class="flex flex-col gap-8">
    <!-- Main Publishing Options -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <div
        class="option-card main-option bg-white rounded-xl p-8 shadow-md transition-all duration-300 ease-in-out hover:scale-105 hover:shadow-lg cursor-pointer text-center border-2 border-transparent hover:border-indigo-600"
        (click)="generateInlineCode()"
      >
        <div class="text-indigo-600 mb-4 flex justify-center">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="16 18 22 12 16 6"></polyline>
            <polyline points="8 6 2 12 8 18"></polyline>
          </svg>
        </div>
        <h3 class="text-xl text-gray-900 font-semibold mb-2">Inline Embed Code</h3>
        <p class="text-gray-500 text-sm">Install Code Yourself</p>
      </div>

      <div
        class="option-card main-option bg-white rounded-xl p-8 shadow-md transition-all duration-300 ease-in-out hover:scale-105 hover:shadow-lg cursor-pointer text-center border-2 border-transparent hover:border-indigo-600"
        (click)="selectMainOption('email')"
      >
        <div class="text-indigo-600 mb-4 flex justify-center">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
        </div>
        <h3 class="text-xl text-gray-900 font-semibold mb-2">Email To Developer</h3>
        <p class="text-gray-500 text-sm">Send integration details via email</p>
      </div>

      <div class="option-card api-key-card bg-white rounded-xl p-8 shadow-md transition-all duration-300 ease-in-out hover:scale-105 hover:shadow-lg relative text-center">
        <div class="text-indigo-600 mb-4 flex justify-center">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <circle cx="12" cy="17" r="1"></circle>
          </svg>
        </div>
        <h3 class="text-xl text-gray-900 font-semibold mb-2">API Key for the Plugin</h3>
        <div class="flex items-center gap-2 mt-4">
          <input type="text" [value]="apiKey" readonly class="flex-1 p-3 border border-gray-300 rounded-md font-mono text-sm bg-gray-50 focus:outline-none">
          <button (click)="copyApiKey()" class="p-3 bg-indigo-600 text-white border-none rounded-md cursor-pointer flex items-center justify-center hover:bg-indigo-700">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Configuration Panels -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Inline Embed Code Panel -->
      <div class="left-panel section-card bg-white rounded-xl p-8 shadow-md">
        <h3 class="text-xl text-gray-900 font-semibold mb-4">Inline Embed Code</h3>
        <div class="mb-6">
          <label class="block mb-2 text-gray-700 font-medium">Select Story</label>
          <select [(ngModel)]="config.story" class="w-full p-3 border border-gray-300 rounded-md bg-white text-base">
            <option value="hello">(Hello),</option>
            <option value="welcome">Welcome Message</option>
            <option value="support">Support Bot</option>
          </select>
        </div>

        <div class="mb-6 relative">
          <label class="block mb-2 text-gray-700 font-medium">Select Background Color</label>
          <div class="mt-2">
            <div
              class="w-16 h-16 rounded-full border-4 border-gray-200 flex items-center justify-center cursor-pointer transition-all duration-200 ease-in-out hover:border-gray-400"
              [style.backgroundColor]="config.theme.primaryColor"
              (click)="toggleColorPickerPopup()"
            >
              <span class="text-white text-2xl font-bold">+</span>
            </div>
          </div>
          
          <!-- Custom Color Picker Popup -->
          <div *ngIf="showColorPickerPopup" class="absolute z-10 mt-2 p-4 bg-white rounded-lg shadow-xl border border-gray-200">
            <div class="grid grid-cols-4 gap-2 mb-4">
              <div *ngFor="let color of predefinedColors"
                   class="w-8 h-8 rounded-full cursor-pointer transition-transform duration-100 ease-in-out hover:scale-110"
                   [style.backgroundColor]="color"
                   [class.border-2]="temporaryColor === color"
                   [class.border-indigo-600]="temporaryColor === color"
                   (click)="selectSwatchColor(color)">
              </div>
            </div>
            
            <div class="mb-4">
              <div class="flex items-center gap-2">
                <input type="color" [(ngModel)]="temporaryColor" class="w-12 h-12">
                <input type="text" [(ngModel)]="temporaryColor" class="w-full p-2 border border-gray-300 rounded-md text-sm font-mono" maxlength="7">
              </div>
            </div>
            
            <div class="flex justify-end gap-2">
              <button (click)="cancelColor()" class="px-4 py-2 text-gray-600 rounded-md text-sm hover:bg-gray-100 transition-colors">
                Cancel
              </button>
              <button (click)="confirmColor()" class="px-4 py-2 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700 transition-colors">
                OK
              </button>
            </div>
          </div>
        </div>

        <button
          class="w-full p-3 bg-indigo-600 text-white rounded-lg text-base font-medium cursor-pointer transition-colors duration-200 hover:bg-indigo-700"
          (click)="generateInlineCode()"
        >
          Generate Code
        </button>
      </div>

      <!-- Landing Bot Panel -->
      <div class="right-panel section-card bg-white rounded-xl p-8 shadow-md">
        <h3 class="text-xl text-gray-900 font-semibold mb-4">Landing Bot</h3>
        <p class="text-gray-500 text-sm mb-6">Use this URL to send the user to the landing page chatbot.</p>

        <div class="mb-4">
          <input type="text" [value]="landingUrl" readonly class="w-full p-3 border border-gray-300 rounded-md bg-gray-50 text-sm text-gray-600 focus:outline-none">
        </div>

        <div class="mb-6">
          <label class="block mb-2 text-gray-700 font-medium">Background Style</label>
          <div class="flex flex-col gap-2">
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="backgroundStyle" value="gradient" [(ngModel)]="landingConfig.backgroundStyle" class="mr-2">
              <span class="text-gray-700">Gradient</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="backgroundStyle" value="plain-primary" [(ngModel)]="landingConfig.backgroundStyle" class="mr-2">
              <span class="text-gray-700">Plain Primary</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="backgroundStyle" value="plain-secondary" [(ngModel)]="landingConfig.backgroundStyle" class="mr-2">
              <span class="text-gray-700">Plain Secondary</span>
            </label>
          </div>
        </div>

        <button
          class="w-full p-3 bg-indigo-600 text-white rounded-lg text-base font-medium cursor-pointer transition-colors duration-200 hover:bg-indigo-700"
          (click)="saveLandingConfig()"
        >
          Save
        </button>
      </div>
    </div>
  </div>

  <!-- Code Modal -->
  <div class="modal-overlay" *ngIf="showCodeModal" (click)="closeModal()">
    <div class="bg-white rounded-xl max-w-3xl w-11/12 max-h-[90vh] overflow-y-auto" (click)="$event.stopPropagation()">
      <div class="flex justify-between items-center p-6 border-b border-gray-200">
        <h3 class="text-gray-900 text-xl font-semibold m-0">Embed Code</h3>
        <button class="bg-none border-none text-2xl cursor-pointer text-gray-500 p-1 hover:text-gray-700" (click)="closeModal()">×</button>
      </div>
      <div class="p-6">
        <div class="relative bg-gray-900 text-gray-50 p-4 rounded-lg my-4">
          <pre><code class="overflow-x-auto font-mono text-sm">{{generatedCode}}</code></pre>
          <button
            class="absolute top-2 right-2 bg-gray-700 text-white border-none px-4 py-2 rounded-md text-xs cursor-pointer hover:bg-gray-600"
            (click)="copyCode()"
          >
            {{codeCopied ? 'Copied!' : 'Copy Code'}}
          </button>
        </div>
        <div class="bg-sky-50 p-4 rounded-lg border-l-4 border-sky-600">
          <h4 class="m-0 text-gray-900 font-semibold mb-2">How to use:</h4>
          <ol class="m-0 pl-6 list-decimal text-gray-700">
            <li>Copy the code above</li>
            <li>Paste it before the closing &lt;/body&gt; tag of your website</li>
            <li>The chatbot will appear automatically</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <!-- Email Modal -->
  <div class="modal-overlay" *ngIf="showEmailModal" (click)="closeEmailModal()">
    <div class="bg-white rounded-xl max-w-3xl w-11/12 max-h-[90vh] overflow-y-auto" (click)="$event.stopPropagation()">
      <div class="flex justify-between items-center p-6 border-b border-gray-200">
        <h3 class="text-gray-900 text-xl font-semibold m-0">Email Integration Details</h3>
        <button class="bg-none border-none text-2xl cursor-pointer text-gray-500 p-1 hover:text-gray-700" (click)="closeEmailModal()">×</button>
      </div>
      <div class="p-6">
        <div class="mb-6">
          <label class="block mb-2 text-gray-700 font-medium">Developer Email</label>
          <input
            type="email"
            [(ngModel)]="developerEmail"
            placeholder="developer@company.com"
            class="w-full p-3 border border-gray-300 rounded-md text-base focus:outline-none focus:ring-2 focus:ring-indigo-500"
          >
        </div>
        <div class="mb-6">
          <label class="block mb-2 text-gray-700 font-medium">Message (Optional)</label>
          <textarea
            [(ngModel)]="emailMessage"
            placeholder="Please integrate our chatbot..."
            class="w-full p-3 border border-gray-300 rounded-md text-base min-h-[100px] resize-y focus:outline-none focus:ring-2 focus:ring-indigo-500"
          ></textarea>
        </div>
        <button
          class="w-full p-3 bg-emerald-500 text-white rounded-lg text-base font-medium cursor-pointer transition-colors duration-200 hover:bg-emerald-600"
          (click)="sendEmail()"
        >
          Send Email
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div
    *ngIf="showToast"
    class="fixed bottom-4 right-4 z-50 p-4 rounded-xl shadow-lg transform transition-transform duration-300"
    [ngClass]="{
      'bg-green-500 text-white': toastType === 'success',
      'bg-red-500 text-white': toastType === 'error'
    }"
  >
    {{ toastMessage }}
  </div>
</div>