<!-- User List Component Template -->
<div class="min-h-screen bg-gray-50" (click)="closeAllDropdowns()">
  <!-- Filters Section -->
  <div class="bg-white border-b border-gray-200 px-6 py-4">
    <div class="flex flex-wrap items-center gap-4">
      <!-- Search -->
      <div class="flex-1 min-w-[300px]">
        <div class="relative">
          <input 
            type="text" 
            placeholder="Search..." 
            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
            [(ngModel)]="searchTerm"
            (input)="onSearchChange()"
          />
          <button class="absolute left-3 top-1/2 -translate-y-1/2">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-400">
              <circle cx="11" cy="11" r="8"/>
              <path d="M21 21l-4.35-4.35"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Filter Dropdown -->
      <div class="min-w-[150px] relative">
        <button 
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none bg-white text-left flex items-center justify-between"
          (click)="toggleUserFilterDropdown($event)"
        >
          <span>{{ selectedFilter }}</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-400">
            <polyline points="6,9 12,15 18,9"></polyline>
          </svg>
        </button>
        
        <!-- User Filter Dropdown -->
        <div *ngIf="showUserFilterDropdown" class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50">
          <div class="py-1">
            <button 
              *ngFor="let option of userFilterOptions"
              class="w-full px-3 py-2 text-left hover:bg-blue-50 text-sm"
              [class.bg-blue-50]="selectedFilter === option.value"
              (click)="selectUserFilter(option)"
            >
              {{ option.label }}
            </button>
          </div>
        </div>
      </div>

      <!-- Date Range -->
      <div class="min-w-[200px] relative">
        <input 
          type="text" 
          [placeholder]="dateRange || '07/30/2025 - 08/30/2025'"
          [value]="dateRange"
          readonly
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none cursor-pointer"
          (click)="toggleDatePicker($event)"
        />
        
        <!-- Date Picker -->
        <div *ngIf="showDatePicker" class="absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 p-4 w-96">
          <!-- Quick Date Options -->
          <div class="mb-4">
            <div class="space-y-1">
              <button 
                *ngFor="let option of quickDateOptions"
                class="block w-full px-3 py-2 text-left text-sm hover:bg-gray-50 rounded"
                (click)="selectQuickDate(option)"
              >
                {{ option.label }}
              </button>
            </div>
          </div>
          
          <div class="border-t pt-4">
            <div class="flex gap-4">
              <!-- Left Calendar -->
              <div class="flex-1">
                <div class="flex items-center justify-between mb-4">
                  <button (click)="previousMonth()" class="p-1 hover:bg-gray-100 rounded">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="15,18 9,12 15,6"></polyline>
                    </svg>
                  </button>
                  <h3 class="font-medium">{{ getMonthName(currentMonth) }} {{ currentYear }}</h3>
                  <button (click)="nextMonth()" class="p-1 hover:bg-gray-100 rounded">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="9,18 15,12 9,6"></polyline>
                    </svg>
                  </button>
                </div>
                
                <!-- Calendar Grid -->
                <div class="grid grid-cols-7 gap-1 text-center text-xs">
                  <div class="font-medium text-gray-500 p-2">Su</div>
                  <div class="font-medium text-gray-500 p-2">Mo</div>
                  <div class="font-medium text-gray-500 p-2">Tu</div>
                  <div class="font-medium text-gray-500 p-2">We</div>
                  <div class="font-medium text-gray-500 p-2">Th</div>
                  <div class="font-medium text-gray-500 p-2">Fr</div>
                  <div class="font-medium text-gray-500 p-2">Sa</div>
                  
                  <button 
                    *ngFor="let day of getCalendarDays(currentMonth, currentYear); let i = index"
                    class="p-2 hover:bg-blue-50 rounded text-sm transition-colors"
                    [class.text-gray-400]="i < getFirstDayOfMonth(currentMonth, currentYear) || (day !== null && day > getDaysInMonth(currentMonth, currentYear))"
                    [class.bg-blue-600]="isDateInRange(day, i >= getFirstDayOfMonth(currentMonth, currentYear) && i < getFirstDayOfMonth(currentMonth, currentYear) + getDaysInMonth(currentMonth, currentYear))"
                    [class.text-white]="isDateInRange(day, i >= getFirstDayOfMonth(currentMonth, currentYear) && i < getFirstDayOfMonth(currentMonth, currentYear) + getDaysInMonth(currentMonth, currentYear))"
                    (click)="selectCalendarDate(day, i >= getFirstDayOfMonth(currentMonth, currentYear) && i < getFirstDayOfMonth(currentMonth, currentYear) + getDaysInMonth(currentMonth, currentYear))"
                  >
                    {{ day }}
                  </button>
                </div>
              </div>
              
              <!-- Right Calendar (Next Month) -->
              <div class="flex-1">
                <div class="flex items-center justify-between mb-4">
                  <button class="p-1 hover:bg-gray-100 rounded invisible">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="15,18 9,12 15,6"></polyline>
                    </svg>
                  </button>
                  <h3 class="font-medium">{{ getMonthName((currentMonth + 1) % 12) }} {{ currentMonth === 11 ? currentYear + 1 : currentYear }}</h3>
                  <button class="p-1 hover:bg-gray-100 rounded invisible">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="9,18 15,12 9,6"></polyline>
                    </svg>
                  </button>
                </div>
                
                <!-- Next Month Calendar Grid -->
                <div class="grid grid-cols-7 gap-1 text-center text-xs">
                  <div class="font-medium text-gray-500 p-2">Su</div>
                  <div class="font-medium text-gray-500 p-2">Mo</div>
                  <div class="font-medium text-gray-500 p-2">Tu</div>
                  <div class="font-medium text-gray-500 p-2">We</div>
                  <div class="font-medium text-gray-500 p-2">Th</div>
                  <div class="font-medium text-gray-500 p-2">Fr</div>
                  <div class="font-medium text-gray-500 p-2">Sa</div>
                  
                  <button 
                    *ngFor="let day of getCalendarDays((currentMonth + 1) % 12, currentMonth === 11 ? currentYear + 1 : currentYear); let i = index"
                    class="p-2 hover:bg-blue-50 rounded text-sm transition-colors"
                    [class.text-gray-400]="i < getFirstDayOfMonth((currentMonth + 1) % 12, currentMonth === 11 ? currentYear + 1 : currentYear) || (day !== null && day > getDaysInMonth((currentMonth + 1) % 12, currentMonth === 11 ? currentYear + 1 : currentYear))"
                    (click)="selectCalendarDate(day, i >= getFirstDayOfMonth((currentMonth + 1) % 12, currentMonth === 11 ? currentYear + 1 : currentYear) && i < getFirstDayOfMonth((currentMonth + 1) % 12, currentMonth === 11 ? currentYear + 1 : currentYear) + getDaysInMonth((currentMonth + 1) % 12, currentMonth === 11 ? currentYear + 1 : currentYear))"
                  >
                    {{ day }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="min-w-[150px] relative">
        <button 
          class="w-full px-3 py-2 border border-gray-300 rounded-lg outline-none bg-white text-left flex items-center justify-between transition-colors"
          [class.opacity-50]="!hasSelectedUsers()"
          [class.cursor-not-allowed]="!hasSelectedUsers()"
          [class.focus:ring-2]="hasSelectedUsers()"
          [class.focus:ring-blue-500]="hasSelectedUsers()"
          [class.focus:border-blue-500]="hasSelectedUsers()"
          [class.hover:bg-gray-50]="hasSelectedUsers()"
          [disabled]="!hasSelectedUsers()"
          (click)="toggleActionDropdown($event)"
        >
          <span>{{ selectedAction || 'Select an Action' }}</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-400">
            <polyline points="6,9 12,15 18,9"></polyline>
          </svg>
        </button>
        
        <!-- Action Dropdown -->
        <div *ngIf="showActionDropdown && hasSelectedUsers()" class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50">
          <div class="py-1">
            <button 
              *ngFor="let option of actionOptions"
              class="w-full px-3 py-2 text-left hover:bg-blue-50 text-sm transition-colors"
              (click)="selectAction(option)"
            >
              {{ option.label }}
            </button>
          </div>
        </div>
      </div>

      <!-- Import Button -->
      <button 
        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"
        (click)="importUsers()"
      >
        Import
      </button>
    </div>
  </div>

  <!-- Table -->
  <div class="bg-white mx-6 mt-6 rounded-lg border border-gray-200 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-blue-600 text-white">
          <tr>
            <th class="px-4 py-3 text-left font-medium">
              <input 
                type="checkbox" 
                class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                [checked]="selectAll"
                (change)="toggleSelectAll()"
              />
            </th>
            <th class="px-4 py-3 text-left font-medium">NAME</th>
            <th class="px-4 py-3 text-left font-medium">LOCALE</th>
            <th class="px-4 py-3 text-left font-medium">SOURCE</th>
            <th class="px-4 py-3 text-left font-medium">CREATED AT</th>
            <th class="px-4 py-3 text-left font-medium">COUNTRY</th>
            <th class="px-4 py-3 text-left font-medium">OS</th>
            <th class="px-4 py-3 text-left font-medium">PHONE</th>
            <th class="px-4 py-3 text-left font-medium">REFERRAL</th>
            <th class="px-4 py-3 text-left font-medium">TEST USER</th>
            <th class="px-4 py-3 text-left font-medium">CHAT</th>
            <th class="px-4 py-3 text-left font-medium">STATUS</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <tr 
            *ngFor="let user of paginatedUsers; trackBy: trackByUserId"
            class="hover:bg-gray-50 transition-colors"
          >
            <td class="px-4 py-3">
              <input 
                type="checkbox" 
                class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                [checked]="isUserSelected(user.id)"
                (change)="toggleUserSelection(user.id)"
              />
            </td>
            <td class="px-4 py-3">
              <div class="flex items-center gap-3">
                <img 
                  [src]="user.avatar || getDefaultAvatar()" 
                  [alt]="user.name"
                  class="w-10 h-10 rounded-full object-cover"
                />
                <div>
                  <div class="font-medium text-gray-900">{{ user.name }}</div>
                  <button 
                    class="text-xs text-blue-600 hover:underline"
                    (click)="showUserAttributes(user)"
                  >
                    Show Attributes
                  </button>
                </div>
              </div>
            </td>
            <td class="px-4 py-3 text-gray-600">{{ user.locale || '-' }}</td>
            <td class="px-4 py-3 text-gray-600">{{ user.source }}</td>
            <td class="px-4 py-3 text-gray-600">{{ formatDate(user.timestamp) }}</td>
            <td class="px-4 py-3 text-gray-600">{{ user.country }}</td>
            <td class="px-4 py-3 text-gray-600">{{ user.os }}</td>
            <td class="px-4 py-3 text-gray-600">{{ user.phone || '-' }}</td>
            <td class="px-4 py-3 text-gray-600">{{ user.referral || '-' }}</td>
            <td class="px-4 py-3">
              <span 
                class="px-2 py-1 rounded-full text-xs font-medium"
                [class.bg-yellow-100]="user.isTestUser"
                [class.text-yellow-800]="user.isTestUser"
                [class.bg-gray-100]="!user.isTestUser"
                [class.text-gray-800]="!user.isTestUser"
              >
                {{ user.isTestUser ? 'Test User' : 'Regular' }}
              </span>
            </td>
            <td class="px-4 py-3">
              <button 
                class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors"
                (click)="goToConversation(user)"
              >
                Go to Conversation
              </button>
            </td>
            <td class="px-4 py-3">
              <span 
                class="px-2 py-1 rounded-full text-xs font-medium"
                [ngClass]="getStatusBadgeClass(user.status)"
              >
                {{ user.status === 'open' ? 'Active' : user.status === 'closed' ? 'Disable' : 'Inactive' }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="paginatedUsers.length === 0" class="text-center py-12">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" class="mx-auto mb-4 text-gray-300">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="12" cy="7" r="4"/>
      </svg>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No users found</h3>
      <p class="text-gray-500">Try adjusting your search or filter criteria.</p>
    </div>
  </div>

  <!-- Pagination -->
  <div class="bg-white mx-6 mt-4 rounded-lg border border-gray-200 px-6 py-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-2">
          <select 
            class="border border-gray-300 rounded px-2 py-1 text-sm"
            [(ngModel)]="recordsPerPage"
            (change)="onRecordsPerPageChange()"
          >
            <option value="20">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
          <span class="text-sm text-gray-600">Records per page</span>
        </div>
        <div class="text-sm text-gray-600">
          Showing {{ ((currentPage - 1) * recordsPerPage) + 1 }} of {{ totalRecords }} results
        </div>
      </div>

      <div class="flex items-center gap-2">
        <button 
          class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          [disabled]="currentPage === 1"
          (click)="previousPage()"
        >
          Previous
        </button>
        
        <button 
          *ngFor="let page of getPageNumbers()"
          class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50 transition-colors"
          [class.bg-blue-600]="page === currentPage"
          [class.text-white]="page === currentPage"
          [class.border-blue-600]="page === currentPage"
          (click)="goToPage(page)"
        >
          {{ page }}
        </button>
        
        <button 
          class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          [disabled]="currentPage === getTotalPages()"
          (click)="nextPage()"
        >
          Next
        </button>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div *ngIf="showConfirmationModal" class="fixed inset-0 z-50 overflow-y-auto">
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity"></div>
    
    <!-- Modal -->
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4" (click)="$event.stopPropagation()">
        <!-- Modal Header -->
        <div class="flex items-center justify-center p-6 pb-4">
          <div class="w-16 h-16 rounded-full flex items-center justify-center"
               [class.bg-red-100]="pendingAction === 'delete' || pendingAction === 'delete_conversation'"
               [class.bg-orange-100]="pendingAction === 'deactivate'"
               [class.bg-green-100]="pendingAction === 'activate'"
               [class.bg-blue-100]="pendingAction === 'make_test_user' || pendingAction === 'remove_test_user'">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                 [class.text-red-600]="pendingAction === 'delete' || pendingAction === 'delete_conversation'"
                 [class.text-orange-600]="pendingAction === 'deactivate'"
                 [class.text-green-600]="pendingAction === 'activate'"
                 [class.text-blue-600]="pendingAction === 'make_test_user' || pendingAction === 'remove_test_user'">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
              <line x1="12" y1="9" x2="12" y2="13"></line>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
          </div>
        </div>
        
        <!-- Modal Body -->
        <div class="px-6 pb-6 text-center">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">{{ getModalTitle() }}</h3>
          <p class="text-sm text-orange-600 mb-4">
            {{ getModalDescription() }}
          </p>
        </div>
        
        <!-- Modal Footer -->
        <div class="flex justify-center gap-3 p-6 pt-0">
          <button 
            class="px-6 py-2 text-sm font-medium text-white bg-red-500 hover:bg-red-600 rounded-lg transition-colors"
            (click)="closeConfirmationModal()"
          >
            No, Keep it
          </button>
          <button 
            class="px-6 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors"
            (click)="confirmAction()"
          >
            {{ getConfirmButtonText() }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Success Toast -->
  <div *ngIf="showSuccessToast" class="fixed top-4 right-4 z-50 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 animate-fade-in-out">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="20,6 9,17 4,12"></polyline>
    </svg>
    <span>{{ successMessage }}</span>
  </div>

  <!-- Import Modal -->
  <div *ngIf="showImportModal" class="fixed inset-0 z-50 overflow-y-auto">
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity" (click)="closeImportModal()"></div>
    
    <!-- Modal -->
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4" (click)="$event.stopPropagation()">
        <!-- Modal Header -->
        <div class="flex items-center justify-between p-6 border-b border-gray-200">
          <h3 class="text-lg font-semibold text-gray-900">Import User</h3>
          <button 
            class="text-gray-400 hover:text-gray-600 transition-colors"
            (click)="closeImportModal()"
          >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        
        <!-- Modal Body -->
        <div class="p-6">
          <!-- Upload Section -->
          <div class="mb-6">
            <h4 class="text-sm font-medium text-gray-700 mb-3">Upload File (CSV)</h4>
            
            <!-- File Input (Hidden) -->
            <input 
              type="file" 
              id="csvFileInput"
              accept=".csv"
              class="hidden"
              (change)="onFileSelected($event)"
            />
            
            <!-- File Drop Zone -->
            <div 
              class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors cursor-pointer"
              (click)="triggerFileInput()"
              [class.border-blue-400]="selectedFile"
              [class.bg-blue-50]="selectedFile"
            >
              <div *ngIf="!selectedFile" class="text-gray-500">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" class="mx-auto mb-2 text-gray-300">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14,2 14,8 20,8"></polyline>
                  <line x1="16" y1="13" x2="8" y2="13"></line>
                  <line x1="16" y1="17" x2="8" y2="17"></line>
                  <polyline points="10,9 9,9 8,9"></polyline>
                </svg>
                <p class="text-sm font-medium mb-1">Choose file</p>
                <p class="text-xs">or drag and drop here</p>
              </div>
              
              <div *ngIf="selectedFile" class="text-blue-600">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" class="mx-auto mb-2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14,2 14,8 20,8"></polyline>
                </svg>
                <p class="text-sm font-medium">{{ selectedFile.name }}</p>
                <p class="text-xs text-gray-500">{{ (selectedFile.size / 1024).toFixed(2) }} KB</p>
              </div>
            </div>
            
            <button 
              class="mt-2 text-blue-600 text-sm hover:underline"
              (click)="triggerFileInput()"
            >
              Browse
            </button>
          </div>
          
          <!-- Info Section -->
          <div class="mb-6">
            <div class="bg-orange-50 border border-orange-200 rounded-lg p-3">
              <p class="text-sm text-orange-800">
                <span class="font-medium">Note:</span> Supported formats: .csv
              </p>
              <p class="text-sm text-orange-700 mt-1">
                <button 
                  class="text-blue-600 hover:underline"
                  (click)="downloadSampleCsv()"
                >
                  Sample Files: CSV
                </button>
              </p>
            </div>
          </div>
          
          <!-- Error Message -->
          <div *ngIf="importError" class="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg">
            <p class="text-sm text-red-800">{{ importError }}</p>
          </div>
          
          <!-- Success Message -->
          <div *ngIf="importSuccess" class="mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
            <p class="text-sm text-green-800">Users imported successfully!</p>
          </div>
          
          <!-- Loading State -->
          <div *ngIf="isImporting" class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
            <div class="flex items-center">
              <div class="animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent mr-2"></div>
              <p class="text-sm text-blue-800">Importing users...</p>
            </div>
          </div>
        </div>
        
        <!-- Modal Footer -->
        <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
          <button 
            class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
            (click)="closeImportModal()"
            [disabled]="isImporting"
          >
            Cancel
          </button>
          <button 
            class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            (click)="performImport()"
            [disabled]="!selectedFile || isImporting || importSuccess"
          >
            <span *ngIf="!isImporting">Import</span>
            <span *ngIf="isImporting" class="flex items-center">
              <div class="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"></div>
              Importing...
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showUserAttributesModal" class="fixed inset-0 z-50 overflow-y-auto">
  <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity" (click)="closeUserAttributesModal()"></div>
  
  <div class="flex items-center justify-center min-h-screen p-4">
    <div class="relative bg-white rounded-lg shadow-xl max-w-lg w-full mx-4" (click)="$event.stopPropagation()">
      <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-blue-600 text-white rounded-t-lg">
        <h3 class="text-lg font-semibold">User Attributes</h3>
        <button class="text-white hover:text-gray-200 transition-colors" (click)="closeUserAttributesModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <div class="p-0">
               <div *ngIf="selectedUserForAttributes!.attributes!.length > 0; else noAttributes">
          <div class="bg-blue-600 text-white px-4 py-2 grid grid-cols-12 gap-2 text-sm font-medium">
            <div class="col-span-4">KEY</div>
            <div class="col-span-6">VALUE</div>
            <div class="col-span-2">ACTION</div>
          </div>
          
          <div class="divide-y divide-gray-200">
                        <div *ngFor="let attribute of selectedUserForAttributes?.attributes; let i = index"
                 class="px-4 py-3 grid grid-cols-12 gap-2 items-center hover:bg-gray-50 text-sm">
              <div class="col-span-4 text-gray-900 font-medium">{{ attribute.key }}</div>
              <div class="col-span-6 text-gray-600">{{ attribute.value }}</div>
              <div class="col-span-2 flex gap-1">
                <button class="p-1 text-red-600 hover:text-red-800 transition-colors"
                        (click)="deleteAttribute(selectedUserForAttributes!, i)" title="Delete">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3,6 5,6 21,6"></polyline>
                    <path d="M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <ng-template #noAttributes>
          <div class="text-center py-8">
            <p class="text-gray-500">This user has no attributes assigned yet.</p>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showAddAttributeModal" class="fixed inset-0 z-50 overflow-y-auto">
  <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity" (click)="closeAddAttributeModal()"></div>
  
  <div class="flex items-center justify-center min-h-screen p-4">
    <div class="relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4" (click)="$event.stopPropagation()">
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">Add User Attribute</h3>
        <button class="text-gray-400 hover:text-gray-600 transition-colors" (click)="closeAddAttributeModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <div class="p-6">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Attribute Key</label>
          <input type="text" placeholder="Enter attribute key" 
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                 [(ngModel)]="newAttributeKey" />
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Attribute Value</label>
          <input type="text" placeholder="Enter attribute value"
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
                 [(ngModel)]="newAttributeValue" />
        </div>
        
        <div *ngIf="addAttributeError" class="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg">
          <p class="text-sm text-red-800">{{ addAttributeError }}</p>
        </div>
        
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
          <p class="text-sm text-blue-800">
            <span class="font-medium">Note:</span> This attribute will be added to {{ selectedUsers.length }} selected user{{ selectedUsers.length > 1 ? 's' : '' }}.
          </p>
        </div>
      </div>
      
      <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
        <button class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                (click)="closeAddAttributeModal()">Cancel</button>
        <button class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors"
                (click)="saveUserAttribute()">Save Attribute</button>
      </div>
    </div>
  </div>
</div>